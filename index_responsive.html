<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Calendrier 2025</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    @media print {
      header, .print\:hidden { display: none !important; }
      .print\:block { display: block !important; }
      .shadow-sm, .shadow-md { box-shadow: none !important; }
      .min-h-[120px] { min-height: 80px !important; }
      body { background: white !important; }
      .break-inside-avoid { break-inside: avoid !important; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50 text-slate-900">
  <header class="sticky top-0 z-10 bg-white/80 backdrop-blur border-b border-slate-200 print:hidden p-4 flex justify-between">
    <h1 class="text-2xl font-bold">Calendrier 2025</h1>
    <div>
      <button onclick="prevMonth()" class="px-3 py-2 rounded-xl bg-slate-900 text-white">← Mois précédent</button>
      <button onclick="nextMonth()" class="px-3 py-2 rounded-xl bg-slate-900 text-white">Mois suivant →</button>
    </div>
  </header>

  <main class="max-w-6xl mx-auto px-4 py-6">
    <h2 id="monthTitle" class="text-xl font-semibold mb-4"></h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2 select-none" id="calendarGrid">
      <!-- jours -->
    </div>
  </main>

  <!-- Modal -->
  <div id="modal" class="hidden fixed inset-0 bg-black/40 flex items-center justify-center">
    <div class="bg-white rounded-xl shadow-xl w-96 p-4">
      <h3 id="modalTitle" class="text-lg font-semibold mb-2"></h3>
      <textarea id="dayNote" class="w-full border border-blue-400 rounded p-2 mb-3" rows="4" placeholder="Écris une note…"></textarea>
      <div class="flex justify-end gap-2">
        <button onclick="saveNote()" class="px-3 py-2 rounded bg-slate-900 text-white">Enregistrer</button>
        <button onclick="deleteNote()" class="px-3 py-2 rounded border border-red-300 text-red-700">Supprimer</button>
        <button onclick="closeModal()" class="px-3 py-2 rounded border">Fermer</button>
      </div>
    </div>
  </div>

  <script>
    const MONTHS_FR = ["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"];
    const DOW_FR = ["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"];
    const YEAR = 2025;

    let month = new Date().getMonth();
    let notes = JSON.parse(localStorage.getItem("calendar_notes") || "{}");
    let selectedISO = null;

    function isoDate(y,m,d){return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`}
    function daysInMonth(y,m){return new Date(y,m+1,0).getDate()}
    function monthMatrix(y,m){
      const first = new Date(y,m,1);
      const total = daysInMonth(y,m);
      const startIndex = (first.getDay()+6)%7;
      const cells=[];
      for(let i=0;i<startIndex;i++)cells.push(null);
      for(let d=1;d<=total;d++)cells.push(d);
      while(cells.length%7!==0)cells.push(null);
      const weeks=[];
      for(let i=0;i<cells.length;i+=7)weeks.push(cells.slice(i,i+7));
      return weeks;
    }

    function renderCalendar(){
      document.getElementById("monthTitle").textContent = MONTHS_FR[month]+" "+YEAR;
      const grid=document.getElementById("calendarGrid");
      grid.innerHTML="";
      DOW_FR.forEach(d=>{
        const div=document.createElement("div");
        div.textContent=d;
        div.className="text-center font-semibold text-slate-600 py-2";
        grid.appendChild(div);
      });
      const weeks=monthMatrix(YEAR,month);
      weeks.flat().forEach(d=>{
        const iso=d?isoDate(YEAR,month,d):null;
        const cell=document.createElement("div");
        cell.className="min-h-[100px] border border-blue-400 rounded p-2 bg-white flex flex-col";
        if(d){
          const head=document.createElement("div");
          head.className="flex justify-between items-center";
          head.innerHTML=`<span class='font-semibold'>${d}</span>`;
          if(notes[iso]) head.innerHTML+=`<span class='text-xs bg-amber-500 text-white rounded px-2'>Note</span>`;
          cell.appendChild(head);
          cell.onclick=()=>openModal(iso);
          cell.classList.add("cursor-pointer");
        } else {
          cell.classList.add("opacity-40");
        }
        grid.appendChild(cell);
      });
    }

    function prevMonth(){month=Math.max(0,month-1);renderCalendar()}
    function nextMonth(){month=Math.min(11,month+1);renderCalendar()}

    function openModal(iso){
      selectedISO=iso;
      document.getElementById("modal").classList.remove("hidden");
      document.getElementById("modalTitle").textContent=`${iso}`;
      document.getElementById("dayNote").value=notes[iso]||"";
    }
    function closeModal(){document.getElementById("modal").classList.add("hidden")}
    function saveNote(){
      if(selectedISO){
        notes[selectedISO]=document.getElementById("dayNote").value;
        localStorage.setItem("calendar_notes",JSON.stringify(notes));
      }
      closeModal();
      renderCalendar();
    }
    function deleteNote(){
      if(selectedISO && notes[selectedISO]){
        delete notes[selectedISO];
        localStorage.setItem("calendar_notes",JSON.stringify(notes));
      }
      closeModal();
      renderCalendar();
    }

    renderCalendar();
  </script>
</body>
</html>
